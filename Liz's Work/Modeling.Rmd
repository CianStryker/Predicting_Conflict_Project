---
title: "Modeling"
author: "Liz Masten"
date: "11/9/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(randomForest)
library(missForest)
library(mice)
library(fastDummies)
library(tidyverse)
```

```{r}

data <- read_csv("Raw_Data_Liz/Final_Data.csv", col_types = cols(
  .default = col_double(),
  country = col_character(),
  iso2c = col_character(),
  continent = col_character()
))

data <- as.data.frame(data)

# data$country <- as.factor(data$country)

data$iso2c <- as.factor(data$iso2c)

data$continent <- as.factor(data$continent)

str(data)

data <- data %>% 
        select(-iso2c)

```

```{r}

# see what's missing: 

p_missing <- unlist(lapply(data, function(x) sum(is.na(x))))/nrow(data)

sort(p_missing[p_missing > 0], decreasing = TRUE)

# ok so most of our variables are missing > 50% of their observations... 

```

```{r}


```


```{r, cache=TRUE}

#Impute

set.seed(2020)

dummy_data <- data %>% 
              dummy_cols(select_columns = c("country"),
                        remove_selected_columns = TRUE, remove_first_dummy = TRUE)

imp_mf <- missForest(dummy_data, variablewise = TRUE, verbose = TRUE, ntree = 50) 

# OOB imputation error est: 

imp_mf$OOBerror

```


```{r}

#split data

set.seed(2020)

test <- sample(seq(nrow(data)), 
                          round(0.2 * nrow(data)))

training <- which(!(seq(nrow(data)) %in% test))

```


```{r}

# random forest w/out imputation

set.seed(2020)

   bag <- randomForest(n_conflict ~., data=data.frame(data[-test,]), 
                              mtry=13, importance =TRUE)
   bag$importance

```

