---
title: "Data Gathering"
author: "Cian Stryker"
date: "10/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(WDI)
library(countrycode)
library(readr)
library(openxlsx)
library(janitor)

```

```{r Gathering Wold Bank Data, cache=TRUE}

# new_cache = WDIcache()

# WDIsearch('CC BY-4.0')

World_Bank_Data <- WDI(indicator = c("gdp_current_US" = "NY.GDP.MKTP.CD",
                                     "gdp_per_capita" = "NY.GDP.PCAP.CD",
                                     "population" = "SP.POP.TOTL",
                                     "population_growth_rate" = "SP.POP.GROW",
                                     "infant_mortality" = "SH.DTH.IMRT",
                                     "unemployment" = "SL.UEM.TOTL.NE.ZS",
                                     "percent_male_population" = "SP.POP.TOTL.MA.ZS",
                                     "oil_rent_percent_gdp" = "NY.GDP.PETR.RT.ZS",
                                     "natural_gas_percent_gdp" = "NY.GDP.NGAS.RT.ZS", 
                                     "mineral_rent_percent_gdp" = "NY.GDP.MINR.RT.ZS", 
                                     "natual_resources_rent_percent_gdp" = "NY.GDP.TOTL.RT.ZS"), 
                       country = "all", start = 1960, extra = FALSE)

World_Bank_Data$country <- countrycode(World_Bank_Data$country, "country.name", "country.name")


Data_Set <- World_Bank_Data %>%
  filter(country != "NA")

Data_Set$continent = Data_Set$country

Data_Set$continent <- countrycode(Data_Set$country, "country.name", "continent")

Data_Set <- Data_Set %>%
  select(country, iso2c, year, continent, everything())

```

```{r Making Excel Data}

write.xlsx(Data_Set, "Raw_Data/First_Draft_Data.xlsx")

```

```{r Loading in Data}

# It takes way less time to load in data from the excel file
# than in takes to create the data directly from the World Bank

Data_Set <- read.xlsx("Raw_Data/First_Draft_Data.xlsx") 

Data_Set$year <- as.factor(Data_Set$year)
```

```{r HDI Data}

hdi_data <- read_csv("Raw_Data/Human Development Index (HDI).csv", col_types = cols(
                                                                    .default = col_character(),
                                                                    `HDI Rank (2018)` = col_double()
                      ))

hdi_data <- hdi_data[,-1]

hdi_data2 <- reshape2::melt(hdi_data, measure.vars = 2:30) %>%
  clean_names()

colnames(hdi_data2)[colnames(hdi_data2) == 'variable'] <- "year"
colnames(hdi_data2)[colnames(hdi_data2) == 'value'] <- "hdi"

hdi_data2$country <- countrycode(hdi_data2$country, "country.name", "country.name") 

hdi_data2 <- hdi_data2 %>%
  filter(country != "NA") 


Data_Set2 <- left_join(Data_Set, hdi_data2)
```

```{r Making More Excel Data}

write.xlsx(Data_Set, "Raw_Data/Second_Draft_Data.xlsx")

```